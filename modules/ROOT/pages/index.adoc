= Anypoint MQ Overview
:page-aliases: mq-understanding.adoc

Anypoint MQ is a multi-tenant, cloud-based message queuing service for exchanging data asynchronously between your applications. 
The Anypoint MQ messaging broker enables applications to communicate by publishing a Mule message to a queue so that another app can consume the message.

Anypoint MQ is fully integrated with Anypoint Platform and provides the same management capabilities.
Integration with access management enables you to specify environments and business groups for 
role-based access control and support for connected apps.

Anypoint MQ supports hybrid use cases, IoT (Internet of Things) in which you collect data from different devices,
and a REST API to use with device applications.
You can also use Anypoint MQ with other app frameworks such as node.js to communicate with queues.

The following spotlight video gives an overview of Anypoint MQ:

++++
include::_partials/mq-overview-video.html[]
++++


Anypoint MQ:

* Provides fully hosted and managed xref:mq-queues.adoc[queues] and xref:mq-exchanges[message exchanges] in the cloud.
* Supports large payloads, encryption, queuing, and publish/subscribe (pub/sub) paradigms.
* Enables you to easily connect to non-Mule applications using the REST API.
* Provides Anypoint Studio access, which makes the process of leveraging your queues and message exchanges as simple as drag, drop, and configure.


== Before You Begin Using Anypoint MQ

* Obtain an Enterprise subscription.
* Contact your Account Team to activate Anypoint MQ.
* Set up your environment and permissions.
+
See xref:mq-access-management.adoc[].
* Review this overview for information about Anypoint MQ.


== Anypoint MQ Features

Anypoint MQ includes these features:

Queues and Message Exchanges::
Send messages to queues, pull messages from queues, create a message exchange to perform pub/sub scenarios to send a message to multiple queues.
Management Console::
Monitor queue statistics, purge queues, and see how many messages are in flight using the management console.
Anypoint MQ Connector::
Send and receive messages from any Mule app, whether it's deployed in CloudHub or used in a hybrid scenario and deployed on-premises.
Usage Information::
Organization administrators or owners can view the current and past months' usage, including the total number of messages and API requests.
Access this information from the *Access Management* page.
For information, see xref:mq-usage.adoc[].
REST API::
Use the REST API to easily communicate with non-Mule applications.
Environments and Role-Based Access Control::
Anypoint MQ is fully integrated with Access Management, allowing you to specify different environments for your queues, who can access each environment, and what they can do within each environment.
Client Management::
Use xref:mq-connected-apps.adoc[connected apps] to authenticate with Anypoint Platform using APIs.
+
Register each consumer registered as a connected app with a name, ID, and a secret.
The connected app uses the ID and secret to authenticate and get access to queues and message exchanges within a single environment.
You cannot use connected apps across multiple environments or business groups.
Large Payloads::
Anypoint MQ supports payloads up to 10 MB.
// MQ Payload Conversion
include::partial$mq-big-payload.adoc[tag=mqPayloadConvert]

[[disaster-recovery]]
Disaster Recovery::
Within each region, Anypoint MQ services deploy to multiple availability zones (AZs) to provide high availability (HA). If service in one availability zone goes down, the Anypoint MQ service operates normally in that region. If all availability zones go down in a region, the Anypoint MQ service is unavailable in that region until at least one of the availability zones comes back up. Because the storage solution for Anypoint MQ is durable, messages that were already in the Anypoint MQ system before service was interrupted are retained.

[[usage-statistics]]
Usage Statistics::
View usage statistics so that you can manage peak usage and subscription parameters.
The chart provides current and past usage, including consumed data, API requests, and the total number of messages received.
See xref:mq-usage.adoc[] to access usage information.
+
You can also use the xref:mq-apis.adoc#mqstatapi[Anypoint MQ Stats API] to perform statistical analysis of queue performance.
+
[NOTE]
Anypoint MQ does not support use with CloudHub Insight or Anypoint Monitoring.


[[queues-and-exchanges]]
== Queues and Message Exchanges

_Message queues_ provide temporary storage that enables applications to communicate in a scalable and reliable way.
Publishers can publish messages into queues, and subscribers can receive messages from queues. 

image::mq-pub-q-sub.png[Anypoint MQ publisher, queue, and subscriber]


_Message exchanges_ bind one or more queues so you can distribute a single message to multiple consumers.
Messages sent to an exchange appear in all its bound queues simultaneously:

image::mq-pub-ex-sub.png["Message exchange distributing a message to multiple consumers"]

For example, if a publisher publishes changes in the weather, and multiple apps need to receive that data,
use a message exchange to publish a single message to multiple queues for each app.

A _binding_ is a relationship between the queue and message exchange, which tells the message exchange where to send messages.

* You can bind a queue to multiple message exchanges.
* {empty}
// Max Msg Exchange 
include::partial$mq-msg-exchange.adoc[tag=msgExchangeMax]
* {empty}
include::partial$mq-msg-exchange.adoc[tag=msgExchangeMaxRouting]


In this example, an app running Salesforce customer relationship manager (CRM) uses Anypoint MQ to 
communicate with two applications that handle different databases:

image::mq-crm-to-dbs.png["CRM sends a message to Anypoint MQ that apps receive"]

The Salesforce app sends a pub/sub message to an Anypoint MQ message exchange (`customer-updates`),
and the two applications (`customer-consumer-1` and `customer-consumer-2` receive the message from 
the message exchange and send it to their respective databases.


[[queue-benefits]]
=== Benefits of Queues

Queues provide these benefits:

* *Horizontal scalability*
+
By putting a message on a queue, the work to process that message can be distributed over multiple subscribers.
* *Reliability*
+
Queues ensure that messages are always processed, even in the case of failure.
+
Anypoint MQ provides reliability with queues using a lock and acknowledge mechanism.
These features ensure that a message is always processed, even in the case of failure.
+
* *Decoupling*
+
You can use a queue as a communication mechanism between different applications and devices,
enabling them to have different development life cycles or maintenance windows, without affecting other applications.
* *Aggregation*
+
Multiple message producers can publish to a single queue, which enables easy consumption by consumers.
+
.. A consumer retrieves messages from a queue. This locks the messages and makes the messages invisible to all other consumers.
.. When retrieving, the consumer specifies a lock timeout. If the message is not processed within that time window, the message is made visible to other consumers to be processed. This ensures that if there was a failure of some sort, such as the consumer node crashed, a message can be processed by another node. A locked message does not block other messages to be read. The lock makes a message unavailable to other applications while locked.
+
If a consumer processes a message successfully, the client acknowledges the message, and Anypoint MQ removes the message from the queue.
For more information about how Anypoint MQ processes acknowledged messages, see xref:anypoint-mq-connector::anypoint-mq-ack.adoc[ACK and NACK Operations].
+
If a consumer is not able to process a message, the message proceeds with a negative acknowledgment and becomes visible in the queue again.

* *Unlimited messages in a queue*
+
Anypoint MQ doesn't limit the number of messages in a queue.
Each message in a queue is limited to 10 MB. 
* *Long polling*
+
Messages are read through long polling. The server holds a request open until new data is available, and then Anypoint MQ delivers a batch of messages with a single read.

* *Billing and charging*
+
Billing is based on the number of messages delivered to subscribers from queues, not the number of queues or message exchanges you create.


[[queue-features]]
=== Queue Features

[[delay-queues]]
* *Delay Queues*
+
With delay queues, you can postpone the delivery of new messages to a queue for a specified period.
Consumers can't see messages sent to a delay queue for the duration of the delay period.
The minimum delay for a queue is 0 seconds. The maximum is 15 minutes.
+ 
If you change the queue delay for:

** Standard queues, the setting change doesn't affect messages in the queue.
** FIFO queues, the setting change is retroactive to all messages in the queue.
+
You can override the default queue delay for a particular message in a standard queue only.

[[dead-letter-queues]]
* *Dead-Letter Queues*
+
Dead-letter queues store undeliverable messages.
+
For information, see xref:mq-queues.adoc#dead-letter-queues[Dead Letter Queues].

[[delay-messages]]
* *Delayed Message Delivery*
+
For messages in a standard queue, you can postpone the delivery of a particular message to the queue for a specified period. Consumers can't see messages sent with delivery delay for the duration of the delay period.
The minimum delivery delay for a message is 0 seconds.
The maximum is 15 minutes.
+ 
Delayed delivery is not supported for individual messages in a FIFO queue.

[[fifo-queues]]
* *FIFO Queues*
+
For applications where the order of messages must be strictly preserved and enforced, Anypoint MQ provides first in, first out (FIFO) processing to ensure message ordering.
+
For information, see xref:mq-queues.adoc#fifo-queues[FIFO Queues].

[[message-groups]]
* *Message Groups*
+
With FIFO queues, you can assign messages to a message group to enable multiple consumers to process messages from a single FIFO queue.
+
For information, see xref:mq-queues.adoc#fifo-queues-msg-groups[FIFO Queues and Message Groups].

[[encrypt-queue]]
* *Encrypted Queues*
+
Messages in queues data can optionally be encrypted, enabling companies to be compliant with their data at rest policies. 
//Shared Encryption
include::partial$mq-faq.adoc[tag=faqEncryption]
+
include::partial$mq-faq.adoc[tag=faqEncryptionQandEx]

[[message-ttl]]
* *Message TTL*
+
Each queue has a message time-to-live (TTL).
TTL specifies how long the message is in the queue before Anypoint MQ expires the message and removes it from the queue.
+
include::partial$mq-ttl.adoc[tag=msgTTLchange]

[message-lock-ttl]
* *Default Acknowledgement Timeout* 
+
How long a message remains unacknowledged before being returned to the queue: for example, in the event of server failure or when flow processing takes too long and times out.

[[mq-glossary]]
== Anypoint MQ Glossary

ACK/NACK::
+
--
* ACK - An app receives a message and Anypoint MQ deletes the message. 
* NACK - An app does not receive a message and Anypoint MQ does not delete the message.
--
+
For information, see xref:anypoint-mq-connector::anypoint-mq-ack.adoc[ACK and NACK Operations].
Binding::
+
Enables pub/sub apps to bridge the simple pub/sub structure and use point-to-point features, such as sending a message to specific applications.
Bindings identify which queues form a message exchange.
In Anypoint Platform, by specifying which message queues are bound to a message exchange, Anypoint MQ creates and manages the bindings for you.
+
For information, see xref:mq-exchanges.adoc[].
Dead Letter Queue (DLQ)::
A queue that stores undeliverable messages from other queues.
+
For information, see xref:mq-queues.adoc#dead-letter-queues[Dead Letter Queues].
Destination::
A message exchange or queue. Applications register to a destination and publish messages to the destination. Applications subscribe to a destination to receive a message. Anypoint MQ lets you configure Destinations by creating or maintaining queues or message exchanges.
You configure destinations in Anypoint Studio using Anypoint MQ Connector.
Durable message::
A message that persists until its indicated client receives it.
Duration::
Messages can persist in flight for up to 2 weeks after which messages older than 2 weeks are deleted. 
In Flight::
Messages that are: 
+
--
* Received by a queue, but not deleted
* Awaiting acknowledgment (ACK) or not acknowledgment (NACK)
* Not returned to the queue due to an expired *Default Acknowledgement Timeout* (time-to-live) setting
--
+
In-flight messages are not visible to other consumers. 
+
Anypoint MQ supports up to 120,000 in-flight messages per queue for standard (non-FIFO) queues.
FIFO queues can have up to 10 in-flight messages in each message group.

In Queue::
Messages that have been sent.
+
Anypoint MQ supports unlimited messages in queue for both standard and FIFO queues.
Lock ID::
A lock that lets an app read a queue exclusively.
Anypoint MQ provides the lock when an app acknowledges a message from a queue.
A locked message does not block other messages to be read.
The lock makes a message unavailable to other applications while locked.
Message::
Serializable xref:mule-runtime::about-mule-message.adoc[Mule Message] content that applications send and receive so that the applications can communicate with each other.
Message Exchange::
A pub/sub message source with multiple outputs. Applications register to subscribe to messages that the message exchange publishes.
+
For information, see xref:mq-exchanges.adoc[].
On-premises::
Mule runtime that runs on a computer in your organization.
Payload::
The message content, which can be text, JSON, or CSV (comma-separated values).
Point-to-Point::
A pattern that allows an app to send a message that only a single app can receive.
Pub/Sub (Publish/Subscribe)::
A pattern that distributes messages to multiple consumers.
Publisher::
An app that sends messages to Anypoint MQ.
Queue::
A point-to-point message storage area that holds a message that a client receives.
+
For information, see xref:mq-queues.adoc[].
Subscriber::
An app that receives messages from Anypoint MQ.


[[mq-in-govcloud]]
== Anypoint MQ in MuleSoft Government Cloud

All features of Anypoint MQ are supported in MuleSoft Government Cloud with the following exceptions:

* Unencrypted queues are not supported.
+
All queues are encrypted. 
When xref:mq-queues.adoc#create-a-queue[creating a queue], the *Encryption* option is disabled and defaults to selected.
* xref:mq-client-apps.adoc[Client apps] are not supported.
+
Use 
xref:mq-connected-apps.adoc[connected apps] instead.
* Anypoint Connector for Anypoint MQ versions earlier than 4.x are not supported.
+
Using connected apps with Anypoint MQ requires xref:anypoint-mq-connector::index.adoc[Anypoint MQ Connector 4.x for Mule 4].
* The following REST APIs in the Anypoint MQ Stats API are not supported:
+
--
** https://anypoint.mulesoft.com/exchange/portals/anypoint-platform/f1e97bc6-315a-4490-82a7-23abe036327a.anypoint-platform/anypoint-mq-stats/minor/1.0/console/method/%23322/[Get usage metrics for an org]
** https://anypoint.mulesoft.com/exchange/portals/anypoint-platform/f1e97bc6-315a-4490-82a7-23abe036327a.anypoint-platform/anypoint-mq-stats/minor/1.0/console/method/%23383/[Get usage metrics for an environment within an org]
--
+
You can use Anypoint MQ Stats API to retrieve metrics for queues and exchanges.
See 
xref:mq-apis.adoc#mqstatapi[Anypoint MQ Stats API].


== See Also

* xref:mq-connectors.adoc[]
* xref:mq-faq.adoc[]
* xref:mq-release-notes.adoc[]
* xref:access-management::audit-logging.adoc#to-query-audit-logging-for-anypoint-mq[Anypoint MQ Audit Logging]